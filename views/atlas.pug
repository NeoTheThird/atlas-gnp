head
  title Atlas der Neurop√§diatrie
  link(rel='stylesheet' href='/css/style.css')
  link(rel='stylesheet' href='https://unpkg.com/leaflet@1.3.4/dist/leaflet.css' integrity='sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==' crossorigin='')
  link(rel='stylesheet' href='https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css')
  link(rel='stylesheet' href='https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css')
script(src='https://unpkg.com/leaflet@1.3.4/dist/leaflet.js' integrity='sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==' crossorigin='')
script(src='https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js')
#osm-map
script(type='text/javascript').
  // Create map
  var element = document.getElementById('osm-map');
  element.style = 'height:100vh;';
  var map = L.map(element);
  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  map.setView(L.latLng(47.728569,10.315784), 6);

  const Http = new XMLHttpRequest();
  const url='http://localhost:7000/api/getAtlas';
  Http.open("GET", url);
  Http.send();

  let added = false
  Http.onreadystatechange = (e) => {
    console.log(e);
    let members = JSON.parse(Http.responseText);

    if (!added) {
      added = true;
      let markers = L.markerClusterGroup();
      members.forEach(member => {
        let marker = L.marker(L.latLng(member.latlong[0], member.latlong[1]), {title: member.name});
        if (member.popup) {
          let popup = (member.g_homepage ? "<a href =\"" + member.g_homepage + "\" target=\"_blank\">" : "") +
                      "<h1>" + (member.firma ?
                        member.firma + (member.g_co ? " (" + member.g_co + ") " : "") :
                        (member.title + " " + member.firstname + " " + member.lastname)
                      ) + "</h1>" +
                      (member.g_homepage ? "</a>" : "") +
                      (member.branche ? "<h2>" + member.branche + "</h2>" : "") +
                      (member.beschreibung || "") +
                      //- "<img src=\"" + member.fotourl + "\" alt=\"" + member.name + "\" width=20% height=20% style=\"float: right;\"></img>" +
                      "<h2>" + member.titel + " " + member.vorname + " " + member.nachname + "</h2>" +
                      (member.berufsfunktion ? "<h3>" + member.berufsfunktion + "</h3>" : "") +
                      (member.g_telefon ? "<p> Telefon: " + member.g_telefon + "</p>" : "") +
                      (member.g_email ? "<p> E-Mail: " + member.g_email + "</p>" : "") +
                      (member.g_mobil ? "<p> Mobil: " + member.g_mobil + "</p>" : "") +
                      "<p>" + member.g_strasse + "</br>" +
                        member.g_plz + " " + member.g_ort + "</br>" +
                        member.g_land + "</p>";
          marker.bindPopup(popup)
        }
        markers.addLayer(marker);
      });
      map.addLayer(markers)
    }
  }
